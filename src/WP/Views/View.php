<?php
namespace WP\Views; use Netforum\Traits\SingletonTrait; abstract class View extends Form { use SingletonTrait; protected $group; protected $fields = array('abstract' => array('desc' => 'this is the abstract section.', 'fields' => array('field1' => array('title' => 'abstract field 1', 'desc' => 'you should extend this abstract class and not use it directly.', 'validate' => array('[a-zA-Z0-9_]{5,}', 'must be minimum 5 characters, format (a-z 0-9 _-)'), 'required' => true, 'callback' => null, 'default' => 'some value', 'filter' => 'trim')))); public function __construct() { $this->page = Page::getCurrentPage(); $this->group = snake_case(end(explode('\\', get_called_class()))); if (isset($_POST[$this->page]) && sizeof($_POST[$this->page]) > 0) { !$this->validate() ? $this->flash(true) : $this->store() && $this->flash(); } $this->init(); $this->render(); } protected function init() { register_setting($this->page, $this->group, array($this, 'sanitize')); if (sizeof($this->fields) <= 0) { return false; } array_walk($this->fields, function ($sp55070e, $sp86203c) { $this->makeSection($sp86203c, $sp55070e['desc']); if (isset($sp55070e['js'])) { Input::handleCallback($sp55070e['js']); } array_walk($sp55070e['fields'], function ($spb0e144, $sp52c592) use($sp86203c) { $spb0e144 += array('key' => $sp52c592, 'section' => $sp86203c); $this->makeField($sp52c592, $spb0e144); }); }); } protected function render() { if (sizeof($this->fields) > 0) { settings_fields($this->group); do_settings_sections($this->page); submit_button(); } } protected function makeSection($spd90b85, $spf39713 = null, $sp22cfa5 = null) { if (is_null($sp22cfa5)) { $sp22cfa5 = function () use($spf39713) { print $spf39713; }; } return add_settings_section($this->toSlug($spd90b85), ucwords($spd90b85), $sp22cfa5, $this->page); } protected function makeField($sp745c10, array $sp55070e) { if (is_null($sp55070e['callback'])) { $sp55070e['callback'] = 'textfield'; } if (!is_array($sp55070e['callback'])) { $sp55070e['callback'] = array(__NAMESPACE__ . '\\Input', $sp55070e['callback']); } $sp47776e = $this->toSlug($sp55070e['section']); if (sizeof($sp55070e['args']) <= 0) { $sp55070e['args'] = array('group' => $this->group, 'section' => $sp47776e, 'id' => $sp745c10, 'desc' => $sp55070e['desc'], 'default' => $sp55070e['default'], 'filter' => $sp55070e['filter'], 'js' => $sp55070e['js']); } return add_settings_field($sp745c10, $sp55070e['title'], $sp55070e['callback'], $this->page, $sp47776e, $sp55070e['args']); } protected function toSlug($sp55070e, $sp206c8b = '_') { return preg_replace('/[^\\w]/', $sp206c8b, strtolower($sp55070e)); } }